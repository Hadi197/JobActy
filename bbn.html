<!DOCTYPE html>
<html lang="id" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Benoa, Celukan Bawang, Lembar & Kupang Pilot Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@3.8.0/dist/full.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            min-height: 100vh;
            width: 100%;
        }
                .overflow-y-auto {
            overflow-y: auto;
            scroll-behavior: auto;
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .gradient-bg {
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
        }
        .status-badge {
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        .status-badge:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        .table-row {
            transition: all 0.2s ease;
        }
        .table-row:hover {
            background: linear-gradient(90deg, rgba(59, 130, 246, 0.05) 0%, rgba(30, 64, 175, 0.05) 100%);
            transform: scale(1.01);
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        .fullscreen-icon {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            color: #333;
            border: 1px solid rgba(0, 0, 0, 0.1);
            padding: 8px;
            border-radius: 8px;
            cursor: move;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            user-select: none;
            font-size: 18px;
        }
        .fullscreen-icon:hover {
            background: rgba(255, 255, 255, 1);
            transform: scale(1.05);
        }
        .fullscreen-icon:active {
            cursor: grabbing;
        }
        .fullscreen-icon.dragging {
            transition: none;
            transform: scale(1.05);
        }
    </style>
</head>
<body class="h-full w-full">
    <!-- Header -->
    <header class="glass-effect shadow-xl border-b border-white/20 w-full">
        <div class="w-full px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-3">
                <button id="homeButton" class="flex items-center space-x-4 hover:opacity-80 transition-opacity duration-300 cursor-pointer bg-transparent border-none p-0">
                    <div class="flex items-center space-x-2 mr-4">
                        <!-- Tugboat Icon -->
                        <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 2l-2 5h4l-2 5M3 12h18M3 17h18M3 22h18M9 12v10M15 12v10"/>
                        </svg>
                        <!-- Pilot Boat Icon -->
                        <svg class="w-8 h-8 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 2l-2 5h4l-2 5M3 12h18M3 17h18M3 22h18M9 12v10M15 12v10"/>
                            <circle cx="12" cy="7" r="2" fill="currentColor"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold bg-gradient-to-r from-blue-600 to-blue-700 bg-clip-text text-transparent">
                            Pilot Information Display
                        </h1>
                        <p class="text-gray-600 text-base font-medium">Real-time pilot activity monitoring system</p>
                    </div>
                </button>
                <div class="text-right">
                    <div id="currentTime" class="text-3xl font-mono font-bold bg-gradient-to-r from-blue-600 to-blue-700 bg-clip-text text-transparent"></div>
                    <div id="currentDate" class="text-sm text-gray-600 font-medium"></div>
                    <div class="flex items-center space-x-2 mt-2">
                        <div class="w-2 h-2 bg-green-500 rounded-full pulse-animation"></div>
                        <span class="text-sm text-green-600 font-semibold">Live Updates Active</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Fullscreen Icon -->
    <div id="fullscreenBtn" class="fullscreen-icon" title="Toggle Fullscreen">
        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 3h-6m6 0v6m0-6l-7 7M3 21h6m-6 0v-6m0 6l7-7"></path>
        </svg>
    </div>

    <!-- Main Content -->
    <main class="w-full h-full px-4 sm:px-6 lg:px-8 py-6">
        <!-- Vessel Board -->
        <div class="glass-effect rounded-3xl shadow-2xl overflow-hidden border border-white/20">
            <div class="px-4 py-3 bg-gradient-to-r from-blue-50 to-blue-100 border-b border-white/30">
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-4">
                        <div class="bg-gradient-to-br from-blue-500 to-blue-600 p-1.5 rounded-md shadow-lg">
                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                        </div>
                        <div>
                            <h2 class="text-lg font-bold bg-gradient-to-r from-blue-600 to-blue-700 bg-clip-text text-transparent">
                                Benoa, Celukan Bawang, Lembar & Kupang Activities
                            </h2>
                            <p class="text-gray-600 text-xs font-medium">All pilot activities for Benoa, Celukan Bawang, Lembar and Kupang branches</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-6">
                        <div class="bg-white/80 px-6 py-3 rounded-lg shadow-md border border-white/50 min-w-[240px]">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full"></div>
                                    <span class="text-sm font-semibold text-gray-700">Total Benoa, Celukan Bawang, Lembar & Kupang</span>
                                </div>
                                <div class="text-right">
                                    <div class="text-xl font-bold bg-gradient-to-r from-blue-600 to-blue-700 bg-clip-text text-transparent" id="totalActivities">0</div>
                                    <div class="text-xs text-gray-600">Done: <span id="completedActivities" class="font-semibold text-green-600">0</span></div>
                                </div>
                            </div>
                        </div>

                        </div>
                    </div>
                </div>
            </div>
            <table class="w-full table-fixed text-sm mb-0">
                <thead class="bg-gradient-to-r from-blue-600 to-blue-700 text-white">
                    <tr>
                        <th class="px-6 py-4 text-center text-sm font-bold uppercase tracking-wider w-1/6">
                            <div class="flex items-center justify-center space-x-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"></path>
                                </svg>
                                <span>Nama Kapal</span>
                            </div>
                        </th>
                        <th class="px-6 py-4 text-center text-sm font-bold uppercase tracking-wider w-1/6">
                            <div class="flex items-center justify-center space-x-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                                </svg>
                                <span>Agen</span>
                            </div>
                        </th>
                        <th class="px-6 py-4 text-center text-sm font-bold uppercase tracking-wider w-1/6">
                            <div class="flex items-center justify-center space-x-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                                <span>Gerakan</span>
                            </div>
                        </th>
                        <th class="px-6 py-4 text-center text-sm font-bold uppercase tracking-wider w-1/6">
                            <div class="flex items-center justify-center space-x-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <span>Estimasi</span>
                            </div>
                        </th>
                        <th class="px-6 py-4 text-center text-sm font-bold uppercase tracking-wider w-1/6">
                            <div class="flex items-center justify-center space-x-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                </svg>
                                <span>Pandu</span>
                            </div>
                        </th>
                        <th class="px-6 py-4 text-center text-sm font-bold uppercase tracking-wider w-1/6">
                            <div class="flex items-center justify-center space-x-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <span>Status</span>
                            </div>
                        </th>
                    </tr>
                </thead>
            </table>
            <div class="overflow-y-auto max-h-screen bg-gradient-to-b from-white/50 to-blue-100/30">
                <table class="w-full table-fixed text-sm">
                    <tbody id="boardRows" class="bg-transparent">
                        <!-- Rows will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
            <div id="noDataMessage" class="px-12 py-16 text-center hidden">
                <div class="bg-white/80 backdrop-blur-sm rounded-3xl p-8 shadow-xl border border-white/50 max-w-md mx-auto">
                    <div class="bg-gradient-to-br from-blue-100 to-blue-200 p-6 rounded-full w-24 h-24 mx-auto mb-6">
                        <svg class="w-12 h-12 text-blue-600 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">No Tanjung Perak & Tanjung Wangi Activities</h3>
                    <p class="text-gray-600 font-medium">No pilot activities found for Tanjung Perak and Tanjung Wangi branches.</p>
                    <div class="mt-4 flex justify-center">
                        <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-4 py-2 rounded-full text-sm font-semibold">
                            System Ready
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Update current time
        function updateTime(){
            const now = new Date();
            const ct = document.getElementById('currentTime');
            const cd = document.getElementById('currentDate');
            if(ct) ct.textContent = now.toLocaleTimeString('id-ID', { hour:'2-digit', minute:'2-digit', second:'2-digit' });
            if(cd) cd.textContent = now.toLocaleDateString('id-ID', { weekday:'long', year:'numeric', month:'long', day:'numeric' });
        }
        updateTime(); setInterval(updateTime, 1000);

        // Fetch and render data
        function fetchAndRender(){
            fetch('job.csv')
                .then(r => r.text())
                .then(csvText => {
                    Papa.parse(csvText, {
                        header: true,
                        skipEmptyLines: true,
                        complete: function(results) {
                            const data = results.data;
                            const now = new Date();

                            // Categorize activities
                            const scheduled = [], active = [], completed = [], delayed = [];
                            data.forEach(row => {
                                const requestTime = row.request_time ? new Date(row.request_time) : null;
                                const deployTime = row.pilot_deploy ? new Date(row.pilot_deploy) : null;
                                const endTime = row.pilot_off ? new Date(row.pilot_off) : null;
                                const pilotOnboard = row.pilot_onboard; // Check for pilot onboard data

                                // Priority: Check pilot_onboard first
                                if (pilotOnboard && pilotOnboard.trim() !== '') {
                                    active.push({...row, status: 'serving', pilot_onboard: pilotOnboard});
                                } else if (requestTime && requestTime > now && !deployTime) {
                                    if (requestTime - now <= 30 * 60 * 1000) delayed.push(row);
                                    else scheduled.push(row);
                                } else if (deployTime && !endTime) {
                                    active.push(row);
                                } else if (endTime) {
                                    completed.push(row);
                                } else if (requestTime && requestTime < now && !deployTime) {
                                    delayed.push(row);
                                }
                            });

                            // Combine and sort activities
                            const allActivities = [
                                ...scheduled.map(r => ({...r, priority: 1, status: 'scheduled'})),
                                ...active.map(r => {
                                    // Separate serving activities (higher priority)
                                    if (r.status === 'serving') {
                                        return {...r, priority: 1.5, status: 'serving'};
                                    }
                                    return {...r, priority: 2, status: 'active'};
                                }),
                                ...delayed.map(r => ({...r, priority: 3, status: 'delayed'})),
                                ...completed.map(r => ({...r, priority: 4, status: 'completed'}))
                            ].sort((a, b) => {
                                if (a.priority !== b.priority) return a.priority - b.priority;
                                const aT = new Date(a.request_time || a.pilot_deploy || a.pilot_off || 0);
                                const bT = new Date(b.request_time || b.pilot_deploy || b.pilot_off || 0);
                                return bT - aT;
                            });

                            // Filter for BENO, CELUKAN BAWANG, LEMBAR, and KUPANG branches
                            const filtered = allActivities.filter(a => {
                                return a.name_branch && (
                                    a.name_branch.toUpperCase().includes('BENO') ||
                                    a.name_branch.toUpperCase().includes('CELUKAN BAWANG') ||
                                    a.name_branch.toUpperCase().includes('LEMBAR') ||
                                    a.name_branch.toUpperCase().includes('KUPANG')
                                );
                            });

                            // Sort by estimasi time (ascending)
                            filtered.sort((a, b) => {
                                const aTime = new Date(a.request_time || a.pilot_deploy || a.pilot_off || 0);
                                const bTime = new Date(b.request_time || b.pilot_deploy || a.pilot_off || 0);
                                return aTime - bTime; // ascending order
                            });

                            // Update total activities count (all Benoa, Celukan Bawang, Lembar & Kupang activities)
                            const totalActivitiesEl = document.getElementById('totalActivities');
                            if (totalActivitiesEl) {
                                totalActivitiesEl.textContent = filtered.length;
                            }

                            // Update completed activities count
                            const completedCount = filtered.filter(activity => {
                                let status = (activity.status || 'scheduled').toLowerCase();
                                // If pilot_off or pilot_end is filled, override status to completed
                                if ((activity.pilot_off && activity.pilot_off.trim() !== '') ||
                                    (activity.pilot_end && activity.pilot_end.trim() !== '')) {
                                    status = 'completed';
                                }
                                return status === 'completed';
                            }).length;
                            const completedActivitiesEl = document.getElementById('completedActivities');
                            if (completedActivitiesEl) {
                                completedActivitiesEl.textContent = completedCount;
                            }

                            // Render table rows
                            const boardRows = document.getElementById('boardRows');
                            const noDataMessage = document.getElementById('noDataMessage');
                            boardRows.innerHTML = '';

                            if (filtered.length === 0) {
                                noDataMessage.classList.remove('hidden');
                                boardRows.classList.add('hidden');
                            } else {
                                noDataMessage.classList.add('hidden');
                                boardRows.classList.remove('hidden');
                                filtered.forEach(activity => {
                                    const row = createTableRow(activity);
                                    boardRows.appendChild(row);
                                });
                                // Start infinite scroll animation
                                setTimeout(startInfiniteScroll, 500);

                                // Auto refresh data every 10 minutes
                                setTimeout(() => {
                                    fetchAndRender();
                                }, 600000);
                            }
                        }
                    });
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                });
        }

        // Create table row
        function createTableRow(activity) {
            const row = document.createElement('tr');
            row.className = 'table-row border-b-2 border-blue-200 hover:shadow-lg transition-all duration-300';

            const vessel = activity.vessel_name || activity.order_no || 'N/A';
            const branch = activity.name_branch || '';
            const vesselWithBranch = branch ? `${vessel} (${branch})` : vessel;
            const agen = activity.company_name || '-';
            const gerakan = activity.location_name || '-';

            let estimasi = '-';
            if (activity.request_time) {
                const dt = new Date(activity.request_time);
                const timezone = activity.timezone_name || 'WIB';
                estimasi = dt.toLocaleDateString('id-ID', {day:'2-digit', month:'short', year:'numeric'}) + ' ' +
                          dt.toLocaleTimeString('id-ID', {hour:'2-digit', minute:'2-digit'}) + ' ' + timezone;
            } else if (activity.pilot_deploy) {
                const dt = new Date(activity.pilot_deploy);
                const timezone = activity.timezone_name || 'WIB';
                estimasi = dt.toLocaleDateString('id-ID', {day:'2-digit', month:'short', year:'numeric'}) + ' ' +
                          dt.toLocaleTimeString('id-ID', {hour:'2-digit', minute:'2-digit'}) + ' ' + timezone;
            }

            // Determine status - check pilot_off or pilot_end first, then use activity.status
            let status = (activity.status || 'scheduled').toLowerCase();

            // If pilot_off or pilot_end is filled (not null/empty), override status to completed
            if ((activity.pilot_off && activity.pilot_off.trim() !== '') ||
                (activity.pilot_end && activity.pilot_end.trim() !== '')) {
                status = 'completed';
            }

            // Determine pandu data - hide full_name for DELAY status
            const pandu = (status === 'delayed') ? '-' : (activity.full_name || activity.pilot_name || activity.pilot_id || activity.pilot || '-');
            let statusClass = 'bg-gradient-to-r from-gray-400 to-gray-500 text-white';
            let statusText = 'SCHEDULED';
            let statusIcon = '‚è∞';

            switch (status) {
                case 'active':
                    statusClass = 'bg-gradient-to-r from-yellow-400 to-orange-500 text-white';
                    statusText = 'SELESAI PELAYANAN';
                    statusIcon = '‚ö°';
                    break;
                case 'serving':
                    statusClass = 'bg-gradient-to-r from-blue-500 to-cyan-500 text-white';
                    statusText = 'SEDANG DILAYANI';
                    statusIcon = 'üö§';
                    break;
                case 'completed':
                    statusClass = 'bg-gradient-to-r from-green-400 to-green-600 text-white';
                    statusText = 'SELESAI PELAYANAN';
                    statusIcon = '‚úÖ';
                    break;
                case 'delayed':
                    statusClass = 'bg-gradient-to-r from-red-400 to-red-600 text-white';
                    statusText = 'DELAY';
                    statusIcon = '‚ö†Ô∏è';
                    break;
            }

            row.innerHTML = `
                <td class="px-6 py-4 text-sm font-semibold text-gray-900 text-center bg-white/60 backdrop-blur-sm">
                    <div class="flex flex-col items-center justify-center space-y-1">
                        <div class="w-2 h-2 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full"></div>
                        <div class="text-center">
                            <div class="text-base font-bold text-gray-900">${vessel}</div>
                            ${branch ? `<div class="text-xs text-gray-600 font-medium">${branch}</div>` : ''}
                        </div>
                    </div>
                </td>
                <td class="px-6 py-4 text-sm text-gray-700 break-words bg-white/40 backdrop-blur-sm">
                    <div class="flex items-center space-x-2">
                        <svg class="w-4 h-4 text-blue-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                        </svg>
                        <span>${agen}</span>
                    </div>
                </td>
                <td class="px-6 py-4 text-sm text-gray-700 break-words bg-white/60 backdrop-blur-sm">
                    <div class="flex items-center space-x-2">
                        <svg class="w-4 h-4 text-purple-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                        <span>${gerakan}</span>
                    </div>
                </td>
                <td class="px-6 py-4 text-sm text-gray-700 text-center bg-white/40 backdrop-blur-sm">
                    <div class="flex items-center justify-center space-x-2">
                        <svg class="w-4 h-4 text-indigo-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span class="font-medium">${estimasi}</span>
                    </div>
                </td>
                <td class="px-6 py-4 text-sm text-gray-700 text-center bg-white/60 backdrop-blur-sm">
                    <div class="flex flex-col items-center justify-center space-y-1">
                        <div class="flex items-center justify-center space-x-2">
                            <svg class="w-4 h-4 text-teal-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                            <span class="font-medium">${pandu}</span>
                        </div>
                        ${status === 'serving' && activity.pilot_onboard ? `
                        <div class="text-xs text-blue-600 font-medium bg-blue-50 px-2 py-1 rounded-md border border-blue-200">
                            <svg class="w-3 h-3 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            Pilot Onboard: ${new Date(activity.pilot_onboard).toLocaleTimeString('id-ID', {hour:'2-digit', minute:'2-digit'})}
                        </div>
                        ` : ''}
                    </div>
                </td>
                <td class="px-6 py-4 text-center bg-white/40 backdrop-blur-sm">
                    <span class="status-badge inline-flex items-center px-4 py-2 text-sm font-bold rounded-full ${statusClass} shadow-lg">
                        <span class="mr-2">${statusIcon}</span>
                        ${statusText}
                    </span>
                </td>
            `;

            return row;
        }

        // Initial load - data refresh only after all pages displayed
        fetchAndRender();

        // Pagination system with auto-advance
        let currentPage = 0;
        const rowsPerPage = 10;
        let totalPages = 1;
        let tableRows = [];
        let autoAdvanceInterval = null;
        let scrollInterval = null;
        const autoAdvanceDelay = 20000; // 20 seconds per page







        function startInfiniteScroll() {
            // Continuous scroll animation: scroll down continuously, reset to top when reaching bottom
            const tableContainer = document.querySelector('.overflow-y-auto');
            if (tableContainer) {
                // Stop any existing scroll interval
                if (scrollInterval) {
                    clearInterval(scrollInterval);
                    scrollInterval = null;
                }

                // Start continuous scroll: down to bottom then reset to top, repeat
                const scrollHeight = tableContainer.scrollHeight;
                const clientHeight = tableContainer.clientHeight;
                if (scrollHeight > clientHeight) {
                    let currentScroll = 0;
                    const maxScroll = scrollHeight - clientHeight;
                    const scrollStep = maxScroll / 40000; // 200 frames for slower animation

                    scrollInterval = setInterval(() => {
                        currentScroll += scrollStep;
                        if (currentScroll >= maxScroll) {
                            currentScroll = 0; // Reset to top when reaching bottom
                        }

                        tableContainer.scrollTo({
                            top: currentScroll,
                            behavior: 'auto'
                        });
                    }, 10); // 40ms intervals for slower animation
                }
            }
        }






        document.addEventListener('DOMContentLoaded', function() {

            // Fullscreen functionality
            const fullscreenBtn = document.getElementById('fullscreenBtn');
            if (fullscreenBtn) {
                fullscreenBtn.addEventListener('click', function() {
                    if (!document.fullscreenElement) {
                        document.documentElement.requestFullscreen().catch(err => {
                            console.log(`Error attempting to enable fullscreen: ${err.message}`);
                        });
                    } else {
                        document.exitFullscreen();
                    }
                });

                // Update button icon based on fullscreen state
                document.addEventListener('fullscreenchange', function() {
                    const isFullscreen = !!document.fullscreenElement;
                    const icon = fullscreenBtn.querySelector('svg');
                    if (isFullscreen) {
                        icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>';
                        fullscreenBtn.title = 'Exit Fullscreen';
                    } else {
                        icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"></path>';
                        fullscreenBtn.title = 'Enter Fullscreen';
                    }
                });
            }

            // Auto-enter fullscreen when page loads
            function autoEnterFullscreen() {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen().catch(err => {
                        console.log(`Auto-fullscreen failed: ${err.message}`);
                    });
                }
            }

            // Trigger auto-fullscreen after a short delay to ensure page is fully loaded
            setTimeout(autoEnterFullscreen, 500);

            // Draggable fullscreen button functionality
            let isDragging = false;
            let dragStartX = 0;
            let dragStartY = 0;
            let buttonStartX = 0;
            let buttonStartY = 0;

            // Load saved position from localStorage
            const savedPosition = localStorage.getItem('fullscreenBtnPosition');
            if (savedPosition) {
                const pos = JSON.parse(savedPosition);
                fullscreenBtn.style.left = pos.left;
                fullscreenBtn.style.top = pos.top;
                fullscreenBtn.style.right = 'auto';
            }

            function startDrag(e) {
                isDragging = true;
                fullscreenBtn.classList.add('dragging');

                const clientX = e.clientX || (e.touches && e.touches[0].clientX);
                const clientY = e.clientY || (e.touches && e.touches[0].clientY);

                dragStartX = clientX;
                dragStartY = clientY;

                const rect = fullscreenBtn.getBoundingClientRect();
                buttonStartX = rect.left;
                buttonStartY = rect.top;

                e.preventDefault();
            }

            function drag(e) {
                if (!isDragging) return;

                const clientX = e.clientX || (e.touches && e.touches[0].clientX);
                const clientY = e.clientY || (e.touches && e.touches[0].clientY);

                const deltaX = clientX - dragStartX;
                const deltaY = clientY - dragStartY;

                const newLeft = buttonStartX + deltaX;
                const newTop = buttonStartY + deltaY;

                // Keep button within viewport bounds
                const maxLeft = window.innerWidth - fullscreenBtn.offsetWidth;
                const maxTop = window.innerHeight - fullscreenBtn.offsetHeight;

                const constrainedLeft = Math.max(0, Math.min(newLeft, maxLeft));
                const constrainedTop = Math.max(0, Math.min(newTop, maxTop));

                fullscreenBtn.style.left = constrainedLeft + 'px';
                fullscreenBtn.style.top = constrainedTop + 'px';
                fullscreenBtn.style.right = 'auto';

                e.preventDefault();
            }

            function stopDrag() {
                if (isDragging) {
                    isDragging = false;
                    fullscreenBtn.classList.remove('dragging');

                    // Save position to localStorage
                    const rect = fullscreenBtn.getBoundingClientRect();
                    localStorage.setItem('fullscreenBtnPosition', JSON.stringify({
                        left: rect.left + 'px',
                        top: rect.top + 'px'
                    }));
                }
            }

            // Mouse events
            fullscreenBtn.addEventListener('mousedown', startDrag);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', stopDrag);

            // Touch events for mobile
            fullscreenBtn.addEventListener('touchstart', startDrag, { passive: false });
            document.addEventListener('touchmove', drag, { passive: false });
            document.addEventListener('touchend', stopDrag);

            // Home button functionality
            const homeButton = document.getElementById('homeButton');
            if (homeButton) {
                homeButton.addEventListener('click', function() {
                    window.location.href = 'index.html';
                });
            }
        });
    </script>
</body>
</html></content>
<parameter name="filePath">/Users/hadipurwana/Documents/PYTHON/COSTUMER/informasi.html
