<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pilot Monitoring Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        /* subtle gradient line for timelines */
        .timeline-line { background: linear-gradient(90deg, rgba(99,102,241,0.15), rgba(96,165,250,0.15)); }
        .card-hover:hover { transform: translateY(-6px); box-shadow: 0 12px 30px rgba(16,24,40,0.08); }
        /* prevent horizontal scrollbar jump on small timelines */
        .timeline-scroll { -webkit-overflow-scrolling: touch; }
                        /* lightweight aqua/harbor theme variables */
                :root {
                    --harbor-50: #f0f9ff;
                    --harbor-100: #e0f2fe;
                    --harbor-200: #bae6fd;
                    --harbor-300: #7dd3fc;
                    --harbor-400: #38bdf8;
                    --harbor-500: #0ea5e9;
                    --harbor-accent: #60a5fa;
                    --harbor-rose: #fb7185;
                    --harbor-amber: #f59e0b;
                }
                .harbor-bg { background: var(--harbor-50); }
                .harbor-accent { background: linear-gradient(180deg, var(--harbor-400), var(--harbor-300)); }
                .harbor-text { color: var(--harbor-500); }
                        /* Pleasant page background and cards */
                        body { font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; }
                        .page-gradient { background: linear-gradient(180deg, #f7fbff 0%, #eef9ff 50%, #f7fbff 100%); }
                        .decor-wave { position: absolute; left: 0; right: 0; height: 140px; top: 0; pointer-events: none; opacity: 0.9; }
                        .card-soft { background: rgba(255,255,255,0.9); box-shadow: 0 8px 24px rgba(13, 38, 59, 0.06); border: 1px solid rgba(15, 23, 42, 0.03); }
                        .stat-value { letter-spacing: -0.02em; }
                    /* decorative bubbles */
                    .bubble { position: absolute; border-radius: 9999px; opacity: 0.12; filter: blur(12px); transform: translateZ(0); }
                    .bubble--one { width: 220px; height: 220px; left: -40px; top: 60px; background: var(--harbor-accent); }
                    .bubble--two { width: 140px; height: 140px; right: -20px; top: 180px; background: #cfeefd; }
                    .badge-header { display: inline-flex; align-items: center; gap: 8px; padding: 6px 10px; border-radius: 999px; background: linear-gradient(90deg,#e6f7ff,#dbeefe); color: #0369a1; font-weight:600; }
                    .glass { backdrop-filter: blur(6px); }
                    .stat-icon { background: linear-gradient(135deg,var(--harbor-400),var(--harbor-300)); -webkit-background-clip: text; background-clip: text; color: transparent; }
                    .card-entrance { transform: translateY(8px); opacity: 0; animation: entrance 420ms cubic-bezier(.2,.9,.2,1) forwards; }
                    @keyframes entrance { to { transform: none; opacity: 1; } }
                /* ship silhouette */
                .ship-silhouette { position: absolute; left: 4%; bottom: 4%; width: 520px; height: auto; opacity: 0.06; filter: blur(6px) saturate(0.9); pointer-events: none; transform: translateZ(0); }
        /* delay styles */
        .delay-card { background: linear-gradient(180deg, rgba(251,113,133,0.06), rgba(255,245,247,0.03)); border: 1px solid rgba(251,113,133,0.18); }
        .delay-badge { background: var(--harbor-rose); color: white; border: none; }
    </style>
</head>
<body class="harbor-bg min-h-screen page-gradient relative overflow-x-hidden">
        <svg class="decor-wave" viewBox="0 0 1440 320" preserveAspectRatio="none" xmlns="http://www.w3.org/2000/svg">
            <path fill="#e6f7ff" d="M0,64L48,80C96,96,192,128,288,165.3C384,203,480,245,576,234.7C672,224,768,160,864,141.3C960,123,1056,149,1152,176C1248,203,1344,229,1392,242.7L1440,256L1440,0L1392,0C1344,0,1248,0,1152,0C1056,0,960,0,864,0C768,0,672,0,576,0C480,0,384,0,288,0C192,0,96,0,48,0L0,0Z"></path>
        </svg>
        <div class="container mx-auto px-4 py-12 max-w-7xl relative">
        <!-- Header -->
        <div class="text-center mb-8 relative">
            <div class="bubble bubble--one"></div>
            <div class="bubble bubble--two"></div>
            <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 mb-2">
                Pilot Monitoring Dashboard
            </h1>
            <p class="text-md md:text-lg text-gray-600 max-w-3xl mx-auto">
                Real-time monitoring of pilot activities
            </p>
        </div>

        <!-- Stats Cards (harbor themed) -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-6 mt-4">
            <!-- Card 1: Total Data -->
            <div class="relative rounded-lg p-1 ring-0 card-hover overflow-hidden glass card-entrance">
                <div class="absolute left-0 top-0 bottom-0 w-1 rounded-tr-lg rounded-br-lg harbor-accent"></div>
                <div class="flex items-center gap-1 ml-1">
                        <div class="flex-shrink-0 p-0.5 rounded-full" style="background:var(--harbor-50)">
                        <svg class="w-2.5 h-2.5 harbor-text" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 3v18h18"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 13l4-4 4 4 6-6"/></svg>
                    </div>
                    <div>
                        <p class="text-[10px] text-gray-500">Total Data</p>
                        <p id="totalDataTop" class="text-sm md:text-base lg:text-lg font-extrabold text-gray-900">0</p>
                    </div>
                </div>
            </div>

            <!-- Card 2: Total Kapal Delay -->
            <div class="relative rounded-lg p-1 ring-0 card-hover overflow-hidden glass card-entrance">
                <div class="absolute left-0 top-0 bottom-0 w-1 rounded-tr-lg rounded-br-lg" style="background:linear-gradient(180deg,var(--harbor-rose),#fecaca)"></div>
                <div class="flex items-center gap-1 ml-1">
                        <div class="flex-shrink-0 p-0.5 rounded-full" style="background:#fff1f2">
                        <svg class="w-2.5 h-2.5" style="color:var(--harbor-rose)" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 9v4m0 4h.01"/></svg>
                    </div>
                    <div>
                        <p class="text-[10px] text-gray-500">Total Kapal Delay</p>
                        <p id="totalDelayTop" class="text-sm md:text-base lg:text-lg font-extrabold text-rose-600">0</p>
                    </div>
                </div>
            </div>

            <!-- Card 3: Approach Time <30min -->
            <div class="relative rounded-lg p-1 ring-0 card-hover overflow-hidden glass card-entrance">
                <div class="absolute left-0 top-0 bottom-0 w-1 rounded-tr-lg rounded-br-lg" style="background:linear-gradient(180deg,var(--harbor-amber),#fef3c7)"></div>
                <div class="flex items-center gap-1 ml-1">
                        <div class="flex-shrink-0 p-0.5 rounded-full" style="background:#fffbeb">
                        <svg class="w-2.5 h-2.5" style="color:var(--harbor-amber)" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 8v4l3 3"/></svg>
                    </div>
                    <div>
                        <p class="text-[10px] text-gray-500">Approach Time &lt; 10min</p>
                        <p id="totalShortApproachTop" class="text-sm md:text-base lg:text-lg font-extrabold text-amber-600">0</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
    <div class="card-soft rounded-xl overflow-hidden">
            <!-- Filters Header -->
            <div class="px-6 py-4 border-b border-gray-100">
                <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
                    <h2 class="text-2xl font-semibold text-gray-800">Pilot Activity Timelines</h2>
                    <div class="flex items-center gap-3">
                        <div class="relative">
                            <select id="branchSelect" class="appearance-none bg-white border border-gray-200 rounded-lg px-4 py-2 pr-8 focus:outline-none focus:ring-2 focus:ring-indigo-300">
                                <option value="all">All Branches</option>
                            </select>
                            <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                                <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                            </div>
                        </div>
                        <div class="relative">
                            <input type="text" id="vesselSearch" placeholder="Search Vessel..." class="bg-white border border-gray-200 rounded-lg px-4 py-2 pl-10 focus:outline-none focus:ring-2 focus:ring-indigo-300">
                            <div class="absolute inset-y-0 left-0 flex items-center pl-3">
                                <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Timeline Container -->
            <div id="timelineContainer" class="p-6 space-y-6">
                <!-- Cards will be populated here -->
            </div>
        </div>
    </div>

    <script>
        // Load CSV data
        fetch('job.csv')
            .then(response => response.text())
            .then(csvText => {
                Papa.parse(csvText, {
                    header: true,
                    complete: function(results) {
                        const data = results.data;
                        document.getElementById('totalDataTop').textContent = `Total Data: ${data.length}`;
                        let delayCount = 0;
                        let shortApproachCount = 0;
                        const container = document.getElementById('timelineContainer');
                        const select = document.getElementById('branchSelect');
                        const branches = new Set();
                        const branchCounts = {};
                        
                        data.forEach(row => {
                            if (row.name_branch) {
                                branches.add(row.name_branch);
                                branchCounts[row.name_branch] = (branchCounts[row.name_branch] || 0) + 1;
                            }
                        });
                        
                        // Populate select
                        const allOption = document.createElement('option');
                        allOption.value = 'all';
                        allOption.textContent = `All Branches (${data.length})`;
                        select.appendChild(allOption);
                        
                        Array.from(branches).sort().forEach(branch => {
                            const option = document.createElement('option');
                            option.value = branch;
                            option.textContent = `${branch} (${branchCounts[branch]})`;
                            select.appendChild(option);
                        });
                        
                        data.forEach(row => {
                            const card = document.createElement('div');
                            card.className = 'bg-white rounded-xl shadow-md card-hover p-6 border border-gray-200 transition-all duration-300';
                            card.setAttribute('data-branch', row.name_branch || '');
                            card.setAttribute('data-vessel', row.vessel_name || '');
                            
                            const header = document.createElement('h3');
                            header.className = 'text-lg font-semibold text-gray-800 mb-3 flex items-center justify-between';
                            header.innerHTML = `
                                <span class="text-sm md:text-base text-gray-600">${row.vessel_name || 'N/A'}</span>
                                <span class="flex items-center text-sm">
                                    <svg class="w-4 h-4 mr-2 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
                                    </svg>
                                    Order ID: ${row.id_order_header || 'N/A'}
                                </span>
                            `;
                            card.appendChild(header);
                            
                            const branchDiv = document.createElement('div');
                            branchDiv.className = 'text-xs text-gray-500';
                            branchDiv.textContent = row.name_branch || 'N/A';
                            card.appendChild(branchDiv);
                            
                            const details = document.createElement('div');
                            details.className = 'grid grid-cols-1 md:grid-cols-2 gap-3 mb-4 text-xs md:text-sm bg-gray-50 p-3 rounded-lg border';
                            
                            const requestTime = document.createElement('div');
                            requestTime.innerHTML = `<strong class="text-indigo-700">Pilot Request Time:</strong> ${row.pilot_request_time ? new Date(row.pilot_request_time).toLocaleString('id-ID', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' }) : 'N/A'}`;
                            details.appendChild(requestTime);
                            
                            const pilotName = document.createElement('div');
                            pilotName.innerHTML = `<strong class="text-indigo-700">Pilot Name:</strong> ${row.pilot_name || 'N/A'}`;
                            details.appendChild(pilotName);
                            
                            const locationName = document.createElement('div');
                            locationName.innerHTML = `<strong class="text-indigo-700">Location:</strong> ${row.location_name || 'N/A'}`;
                            details.appendChild(locationName);
                            
                            const noPkk = document.createElement('div');
                            noPkk.innerHTML = `<strong class="text-indigo-700">No PKK Inaportnet:</strong> ${row.no_pkk_inaportnet || 'N/A'}`;
                            details.appendChild(noPkk);
                            
                            const guideHours = document.createElement('div');
                            guideHours.innerHTML = `<strong class="text-indigo-700">Guide Hours Change:</strong> ${row.guide_request_hours_change ? new Date(row.guide_request_hours_change).toLocaleString('id-ID', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' }) : 'N/A'}`;
                            details.appendChild(guideHours);
                            
                            card.appendChild(details);
                            
                            const timeline = document.createElement('div');
                            timeline.className = 'relative flex items-center space-x-4 overflow-x-auto bg-gradient-to-r from-indigo-50 to-blue-50 p-4 rounded-lg';
                            
                            // Add connecting line
                            const line = document.createElement('div');
                            line.className = 'absolute top-8 left-8 right-8 h-0.5 timeline-line z-0';
                            timeline.appendChild(line);
                            
                            const steps = [
                                { label: 'Pilot Deploy', time: row.pilot_deploy },
                                { label: 'Pilot Arrive', time: row.pilot_arrive },
                                { label: 'Pilot Onboard', time: row.pilot_onboard },
                                { label: 'Pilot Start', time: row.pilot_start },
                                { label: 'Pilot End', time: row.pilot_end },
                                { label: 'Pilot Off', time: row.pilot_off }
                            ];
                            
                            // Check if Pilot Start to Pilot End duration < 30 minutes
                            const pilotStartTime = row.pilot_start ? new Date(row.pilot_start) : null;
                            const pilotEndTime = row.pilot_end ? new Date(row.pilot_end) : null;
                            const isShortDuration = pilotStartTime && pilotEndTime && (pilotEndTime - pilotStartTime) < 10 * 60 * 1000;
                            if (isShortDuration) shortApproachCount++;
                            
                            steps.forEach((step, index) => {
                                const stepDiv = document.createElement('div');
                                stepDiv.className = 'flex flex-col items-center min-w-0 z-10';
                                
                                const icon = document.createElement('div');
                                const isCompleted = step.time ? true : false;
                                let bgColor = 'bg-gray-400';
                                if (isCompleted) {
                                    if ((step.label === 'Pilot Start' || step.label === 'Pilot End') && isShortDuration) {
                                        bgColor = 'bg-red-500';
                                    } else {
                                        bgColor = 'bg-blue-500';
                                    }
                                }
                                icon.className = `w-10 h-10 rounded-full flex items-center justify-center text-white text-sm font-bold shadow-md ${bgColor}`;
                                icon.innerHTML = step.time ? `
                                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                    </svg>
                                ` : `${index + 1}`;
                                stepDiv.appendChild(icon);
                                
                                const label = document.createElement('div');
                                label.className = 'text-[11px] text-gray-700 mt-2 text-center font-medium';
                                label.textContent = step.label;
                                stepDiv.appendChild(label);
                                
                                const time = document.createElement('div');
                                time.className = 'text-[11px] text-gray-600 mt-1 text-center bg-white px-2 py-1 rounded shadow-sm';
                                if (step.time) {
                                    const date = new Date(step.time);
                                    time.textContent = date.toLocaleString('id-ID', { 
                                        year: 'numeric', 
                                        month: '2-digit', 
                                        day: '2-digit', 
                                        hour: '2-digit', 
                                        minute: '2-digit' 
                                    });
                                } else {
                                    time.textContent = 'Proses';
                                }
                                stepDiv.appendChild(time);
                                
                                timeline.appendChild(stepDiv);
                                
                                if (index < steps.length - 1) {
                                    const spacer = document.createElement('div');
                                    spacer.className = 'w-8';
                                    timeline.appendChild(spacer);
                                }
                            });
                            
                            card.appendChild(timeline);
                            
                            // Cek jika delay
                            const now = new Date();
                            const reqTime = row.pilot_request_time ? new Date(row.pilot_request_time) : null;
                            const deployTime = row.pilot_deploy ? new Date(row.pilot_deploy) : null;
                            if (reqTime && reqTime < now && !deployTime) {
                                // mark card visually as delayed using harbor delay styles
                                card.classList.add('delay-card');
                                const delayDiv = document.createElement('div');
                                delayDiv.className = 'mt-4 p-3 rounded-lg text-center font-semibold delay-badge';
                                delayDiv.textContent = '🚨 DELAY DETECTED';
                                card.appendChild(delayDiv);
                                delayCount++;
                            }
                            
                            container.appendChild(card);
                        });
                        
                        document.getElementById('totalDelayTop').textContent = `Total Kapal Delay: ${delayCount}`;
                        document.getElementById('totalShortApproachTop').textContent = `Approach Time Kurang dari 10 menit = ${shortApproachCount}`;
                        
                        // Filter function
                        function filterCards() {
                            const selectedBranch = document.getElementById('branchSelect').value;
                            const searchTerm = document.getElementById('vesselSearch').value.toLowerCase();
                            const cards = container.querySelectorAll('[data-branch]');
                            cards.forEach(card => {
                                const branch = card.getAttribute('data-branch');
                                const vessel = card.getAttribute('data-vessel').toLowerCase();
                                const branchMatch = selectedBranch === 'all' || branch === selectedBranch;
                                const vesselMatch = !searchTerm || vessel.includes(searchTerm);
                                if (branchMatch && vesselMatch) {
                                    card.style.display = 'block';
                                } else {
                                    card.style.display = 'none';
                                }
                            });
                        }
                        
                        select.addEventListener('change', filterCards);
                        document.getElementById('vesselSearch').addEventListener('input', filterCards);
                    }
                });
            })
            .catch(error => {
                console.error('Error loading CSV:', error);
                document.getElementById('timelineContainer').innerHTML = '<p class="text-center text-gray-500">Error loading data</p>';
            });
    </script>
        <!-- subtle ship silhouette for background ambiance -->
        <svg class="ship-silhouette" viewBox="0 0 800 200" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <g fill="#083344">
                <path d="M10 120 C80 80, 220 60, 320 80 C420 100, 540 110, 760 90 L740 130 L60 130 Z"/>
                <path d="M160 70 L200 40 L250 60 L220 80 Z"/>
                <rect x="340" y="40" width="16" height="48" />
            </g>
        </svg>
</body>
</html>
